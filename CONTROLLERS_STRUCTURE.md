# üìã Estructura de Controladores - Sistema Detalles

## üéØ Arquitectura de Controladores

El sistema est√° organizado siguiendo el patr√≥n **MVC (Model-View-Controller)** con una separaci√≥n clara de responsabilidades por m√≥dulo. Cada m√≥dulo tiene su propio controlador independiente.

---

## üìÇ Controladores Creados (10 Controladores)

### 1. **LoginController** üîê
**Ubicaci√≥n**: `controller/LoginController.java`

**Responsabilidad**: Autenticaci√≥n, gesti√≥n de sesiones y navegaci√≥n general

**Endpoints de Vistas**:
- `GET /` ‚Üí Redirige al login
- `GET /login` ‚Üí P√°gina de inicio de sesi√≥n
- `GET /components/sidebar` ‚Üí Componente de navegaci√≥n lateral

**Endpoints REST a Implementar**:
- `POST /api/login/authenticate` - Autenticar usuario
- `POST /api/login/logout` - Cerrar sesi√≥n
- `GET /api/login/forgot-password` - Recuperar contrase√±a
- `POST /api/login/refresh-token` - Refrescar token JWT

---

### 2. **DashboardController** üìä
**Ubicaci√≥n**: `controller/DashboardController.java`

**Responsabilidad**: Dashboard principal del sistema

**Endpoints de Vistas**:
- `GET /dashboard` ‚Üí Dashboard principal

**Endpoints REST a Implementar**:
- `GET /api/dashboard/stats` - Estad√≠sticas generales
- `GET /api/dashboard/recent-activities` - Actividades recientes
- `GET /api/dashboard/notifications` - Notificaciones

---

### 3. **UsuariosController** üë•
**Ubicaci√≥n**: `controller/UsuariosController.java`

**Responsabilidad**: Gesti√≥n de usuarios, roles y permisos

**Endpoints de Vistas**:
- `GET /usuarios` ‚Üí Gesti√≥n de usuarios
- `GET /roles` ‚Üí Gesti√≥n de roles
- `GET /permisos` ‚Üí Gesti√≥n de permisos

**Endpoints REST a Implementar**:
```
Usuarios:
- GET    /api/usuarios       - Listar usuarios
- GET    /api/usuarios/{id}  - Obtener usuario
- POST   /api/usuarios       - Crear usuario
- PUT    /api/usuarios/{id}  - Actualizar usuario
- DELETE /api/usuarios/{id}  - Eliminar usuario

Roles:
- GET    /api/roles         - Listar roles
- POST   /api/roles         - Crear rol
- PUT    /api/roles/{id}    - Actualizar rol
- DELETE /api/roles/{id}    - Eliminar rol

Permisos:
- GET    /api/permisos              - Listar permisos
- POST   /api/permisos              - Asignar permiso
- DELETE /api/permisos/{id}         - Revocar permiso
```

---

### 4. **ProductosController** üì¶
**Ubicaci√≥n**: `controller/ProductosController.java`

**Responsabilidad**: Gesti√≥n de productos (calzados, accesorios, cat√°logos)

**Endpoints de Vistas**:
- `GET /productos/calzados` ‚Üí Gesti√≥n de calzados
- `GET /productos/accesorios` ‚Üí Gesti√≥n de accesorios
- `GET /productos/catalogos` ‚Üí Cat√°logos de productos

**Endpoints REST a Implementar**:
```
Calzados:
- GET    /api/productos/calzados       - Listar calzados
- GET    /api/productos/calzados/{id}  - Obtener calzado
- POST   /api/productos/calzados       - Crear calzado
- PUT    /api/productos/calzados/{id}  - Actualizar calzado
- DELETE /api/productos/calzados/{id}  - Eliminar calzado

Accesorios:
- GET    /api/productos/accesorios     - Listar accesorios
- POST   /api/productos/accesorios     - Crear accesorio
- PUT    /api/productos/accesorios/{id} - Actualizar accesorio
- DELETE /api/productos/accesorios/{id} - Eliminar accesorio

Cat√°logos:
- GET    /api/productos/catalogos      - Listar cat√°logos
- POST   /api/productos/catalogos      - Crear cat√°logo
```

---

### 5. **ClientesController** üë®‚Äçüíº
**Ubicaci√≥n**: `controller/ClientesController.java`

**Responsabilidad**: Gesti√≥n de clientes

**Endpoints de Vistas**:
- `GET /clientes` ‚Üí Gesti√≥n de clientes

**Endpoints REST a Implementar**:
```
- GET    /api/clientes              - Listar clientes
- GET    /api/clientes/{id}         - Obtener cliente
- POST   /api/clientes              - Crear cliente
- PUT    /api/clientes/{id}         - Actualizar cliente
- DELETE /api/clientes/{id}         - Eliminar cliente
- GET    /api/clientes/search       - Buscar clientes
- GET    /api/clientes/{id}/historial - Historial de compras
```

---

### 6. **VentasController** üí∞
**Ubicaci√≥n**: `controller/VentasController.java`

**Responsabilidad**: Gesti√≥n de ventas y punto de venta (caja)

**Endpoints de Vistas**:
- `GET /ventas` ‚Üí Gesti√≥n de ventas
- `GET /ventas/caja` ‚Üí Punto de venta (caja)

**Endpoints REST a Implementar**:
```
Ventas:
- GET    /api/ventas        - Listar ventas
- GET    /api/ventas/{id}   - Obtener venta
- POST   /api/ventas        - Registrar venta
- PUT    /api/ventas/{id}   - Actualizar venta
- DELETE /api/ventas/{id}   - Anular venta

Caja:
- GET    /api/ventas/caja/estado      - Estado de caja
- POST   /api/ventas/caja/abrir       - Abrir caja
- POST   /api/ventas/caja/cerrar      - Cerrar caja
- GET    /api/ventas/caja/movimientos - Movimientos de caja
```

---

### 7. **ComprasController** üõí
**Ubicaci√≥n**: `controller/ComprasController.java`

**Responsabilidad**: Gesti√≥n de compras y proveedores

**Endpoints de Vistas**:
- `GET /compras` ‚Üí Gesti√≥n de compras
- `GET /compras/proveedores` ‚Üí Gesti√≥n de proveedores

**Endpoints REST a Implementar**:
```
Compras:
- GET    /api/compras       - Listar compras
- GET    /api/compras/{id}  - Obtener compra
- POST   /api/compras       - Registrar compra
- PUT    /api/compras/{id}  - Actualizar compra
- DELETE /api/compras/{id}  - Anular compra

Proveedores:
- GET    /api/compras/proveedores       - Listar proveedores
- POST   /api/compras/proveedores       - Crear proveedor
- PUT    /api/compras/proveedores/{id}  - Actualizar proveedor
- DELETE /api/compras/proveedores/{id}  - Eliminar proveedor
```

---

### 8. **InventarioController** üìä
**Ubicaci√≥n**: `controller/InventarioController.java`

**Responsabilidad**: Gesti√≥n de inventario y stock

**Endpoints de Vistas**:
- `GET /inventario` ‚Üí Gesti√≥n de inventario

**Endpoints REST a Implementar**:
```
- GET  /api/inventario                     - Listar inventario
- GET  /api/inventario/{id}                - Detalle de producto
- PUT  /api/inventario/{id}/ajuste         - Ajustar stock
- GET  /api/inventario/bajo-stock          - Productos con bajo stock
- GET  /api/inventario/movimientos         - Movimientos de inventario
- POST /api/inventario/transferencia       - Transferir entre almacenes
- GET  /api/inventario/kardex/{id}         - Kardex de producto
```

---

### 9. **ReportesController** üìà
**Ubicaci√≥n**: `controller/ReportesController.java`

**Responsabilidad**: Generaci√≥n y visualizaci√≥n de reportes

**Endpoints de Vistas**:
- `GET /reportes` ‚Üí P√°gina de reportes

**Endpoints REST a Implementar**:
```
- GET  /api/reportes/ventas                - Reporte de ventas
- GET  /api/reportes/compras               - Reporte de compras
- GET  /api/reportes/inventario            - Reporte de inventario
- GET  /api/reportes/clientes              - Reporte de clientes
- GET  /api/reportes/productos-mas-vendidos - Productos m√°s vendidos
- GET  /api/reportes/ingresos              - Reporte de ingresos
- POST /api/reportes/generar               - Generar reporte personalizado
- GET  /api/reportes/exportar/{tipo}       - Exportar (PDF, Excel, CSV)
```

---

### 10. **AuditoriaController** üîç
**Ubicaci√≥n**: `controller/AuditoriaController.java`

**Responsabilidad**: Auditor√≠a y logs del sistema

**Endpoints de Vistas**:
- `GET /auditoria` ‚Üí Auditor√≠a del sistema

**Endpoints REST a Implementar**:
```
- GET  /api/auditoria/logs                 - Listar logs
- GET  /api/auditoria/logs/{id}            - Detalle de log
- GET  /api/auditoria/logs/usuario/{id}    - Logs por usuario
- GET  /api/auditoria/logs/accion/{tipo}   - Logs por acci√≥n
- GET  /api/auditoria/accesos              - Registro de accesos
- GET  /api/auditoria/cambios              - Historial de cambios
- POST /api/auditoria/exportar             - Exportar logs
```

---

## üóÇÔ∏è Estructura de Directorios

```
src/main/java/fisi/software/detalles/controller/
‚îú‚îÄ‚îÄ LoginController.java          ‚úÖ Autenticaci√≥n y navegaci√≥n
‚îú‚îÄ‚îÄ DashboardController.java      ‚úÖ Dashboard principal
‚îú‚îÄ‚îÄ UsuariosController.java       ‚úÖ Usuarios, roles, permisos
‚îú‚îÄ‚îÄ ProductosController.java      ‚úÖ Calzados, accesorios, cat√°logos
‚îú‚îÄ‚îÄ ClientesController.java       ‚úÖ Gesti√≥n de clientes
‚îú‚îÄ‚îÄ VentasController.java         ‚úÖ Ventas y caja
‚îú‚îÄ‚îÄ ComprasController.java        ‚úÖ Compras y proveedores
‚îú‚îÄ‚îÄ InventarioController.java     ‚úÖ Inventario y stock
‚îú‚îÄ‚îÄ ReportesController.java       ‚úÖ Reportes del sistema
‚îî‚îÄ‚îÄ AuditoriaController.java      ‚úÖ Auditor√≠a y logs
```

**Total**: 10 Controladores

---

## üé® Patr√≥n de Dise√±o

### Separaci√≥n de Responsabilidades

1. **Controladores de Vista** (`@Controller`)
   - Retornan nombres de plantillas Thymeleaf
   - Manejan la navegaci√≥n entre p√°ginas
   - Ejemplo: `return "dashboard";`

2. **Controladores REST** (A implementar con `@RestController`)
   - Retornan datos en formato JSON
   - Manejan la l√≥gica de negocio a trav√©s de servicios
   - Ejemplo: `return ResponseEntity.ok(data);`

### Convenci√≥n de Nomenclatura

**Vistas**:
- M√©todo: `show{Modulo}()`
- Ruta: `GET /{modulo}`
- Retorno: `"software/{modulo}/{vista}"`

**APIs REST** (a implementar):
- Prefijo: `/api/{modulo}`
- M√©todos HTTP: GET, POST, PUT, DELETE
- Retorno: JSON

---

## üîÑ Pr√≥ximos Pasos

### Fase 1: Servicios ‚ú®
1. Crear `service` package
2. Implementar servicios para cada m√≥dulo
3. Inyectar servicios en controladores

### Fase 2: Modelos (Entidades) ‚ú®
1. Crear `entity` package
2. Definir entidades JPA para cada tabla
3. Mapear relaciones entre entidades

### Fase 3: Repositorios ‚ú®
1. Crear `repository` package
2. Implementar interfaces JPA Repository
3. Agregar consultas personalizadas si es necesario

### Fase 4: DTOs ‚ú®
1. Crear `dto` package
2. Definir DTOs para transferencia de datos
3. Implementar mappers (ModelMapper o MapStruct)

### Fase 5: APIs REST ‚ú®
1. Implementar endpoints REST en cada controlador
2. Agregar validaciones con `@Valid`
3. Implementar manejo de excepciones

### Fase 6: Seguridad ‚ú®
1. Configurar Spring Security completo
2. Implementar JWT para autenticaci√≥n
3. Agregar autorizaci√≥n basada en roles

---

## üìù Notas Importantes

- ‚úÖ Todos los controladores est√°n compilando correctamente
- ‚úÖ La estructura sigue las mejores pr√°cticas de Spring Boot
- ‚úÖ Cada m√≥dulo tiene su propio controlador independiente
- ‚úÖ El c√≥digo est√° documentado con JavaDoc
- ‚úÖ Se incluyen TODOs para los endpoints REST pendientes

---

## üöÄ Ventajas de esta Estructura

1. **Mantenibilidad**: Cada m√≥dulo es independiente y f√°cil de mantener
2. **Escalabilidad**: F√°cil agregar nuevos m√≥dulos sin afectar existentes
3. **Claridad**: El c√≥digo es m√°s legible y organizado
4. **Testabilidad**: Cada controlador se puede probar de forma aislada
5. **Separaci√≥n de Responsabilidades**: Cada controlador tiene una √∫nica responsabilidad

---

**√öltima actualizaci√≥n**: Octubre 2025
**Estado**: ‚úÖ Fase de Controladores Completada
